{"version":3,"file":"jsonBuilder.js","names":["flavors","stringWrap","value","_flavor","AGE","JSON","stringify","jsonStringify","record","flavor","ageJsonStr","isFirst","key","Object","entries","valueWrapped","createVertex","client","graphPathStr","label","createQ","ageCreateVertex","Error","query","createEdge","edgeStartLabel","edgeEndLabel","startNodeName","endNodeName","AGECreateEdge"],"sources":["../../src/tools/jsonBuilder.ts"],"sourcesContent":["/**\n * File: /src/tools/jsonBuilder.ts\n * Project: apache-age-client\n * File Created: 13-09-2022 05:24:37\n * Author: Apache Software Foundation\n * -----\n * Last Modified: 13-09-2022 07:01:22\n * Modified By: Clay Risser\n * -----\n * Risser Labs LLC (c) Copyright 2022\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Client } from \"pg\";\nimport { AgeRecord, Flavor } from \"../types\";\nimport { flavors } from \"../config\";\n\nexport function stringWrap(value: string, _flavor: Flavor = flavors.AGE) {\n  return JSON.stringify(value);\n}\n\nexport function jsonStringify(record: AgeRecord, flavor = flavors.AGE) {\n  let ageJsonStr = \"{\";\n  let isFirst = true;\n  for (const [key, value] of Object.entries(record)) {\n    if (!isFirst) {\n      ageJsonStr = ageJsonStr + \",\";\n    }\n    let valueWrapped = stringWrap(value, flavor);\n    ageJsonStr = ageJsonStr + `${key}:${valueWrapped}`;\n    isFirst = false;\n  }\n  ageJsonStr = ageJsonStr + \"}\";\n  return ageJsonStr;\n}\n\nexport async function createVertex(\n  client: Client,\n  graphPathStr: string,\n  label: string,\n  record: AgeRecord,\n  flavor: Flavor\n) {\n  const createQ = `CREATE (n:${label} ${jsonStringify(record, flavor)})`;\n  if (flavor === \"AGE\") {\n    return ageCreateVertex(client, graphPathStr, createQ);\n  } else {\n    throw new Error(`Unknown flavor ${flavor}`);\n  }\n}\n\nasync function ageCreateVertex(\n  client: Client,\n  graphPathStr: string,\n  createQ: string\n) {\n  await client.query(\n    `select *\n         from cypher('${graphPathStr}', $$ ${createQ} $$) as (a agtype)`\n  );\n}\n\nexport async function createEdge(\n  client: Client,\n  label: string,\n  record: AgeRecord,\n  graphPathStr: string,\n  edgeStartLabel: string,\n  edgeEndLabel: string,\n  startNodeName: string,\n  endNodeName: string,\n  flavor: Flavor\n) {\n  const createQ = `CREATE (:${edgeStartLabel} {name: ${stringWrap(\n    startNodeName,\n    flavor\n  )}})-[n:${label} ${jsonStringify(\n    record,\n    flavor\n  )}]->(:${edgeEndLabel} {name: ${stringWrap(endNodeName, flavor)}})`;\n  if (flavor === \"AGE\") {\n    return AGECreateEdge(client, graphPathStr, createQ);\n  } else {\n    throw new Error(`Unknown flavor ${flavor}`);\n  }\n}\n\nasync function AGECreateEdge(\n  client: Client,\n  graphPathStr: string,\n  createQ: string\n) {\n  await client.query(\n    `select *\n         from cypher('${graphPathStr}', $$ ${createQ} $$) as (a agtype)`\n  );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,SAASA,OAAT;AAEA,OAAO,SAASC,UAAT,CAAoBC,KAApB,EAAkE;EAAA,IAA/BC,OAA+B,uEAAbH,OAAO,CAACI,GAAK;;EACvE,OAAOC,IAAI,CAACC,SAAL,CAAeJ,KAAf,CAAP;AACD;AAED,OAAO,SAASK,aAAT,CAAuBC,MAAvB,EAAgE;EAAA,IAAtBC,MAAsB,uEAAbT,OAAO,CAACI,GAAK;EACrE,IAAIM,UAAU,GAAG,GAAjB;EACA,IAAIC,OAAO,GAAG,IAAd;;EACA,KAAK,MAAM,CAACC,GAAD,EAAMV,KAAN,CAAX,IAA2BW,MAAM,CAACC,OAAP,CAAeN,MAAf,CAA3B,EAAmD;IACjD,IAAI,CAACG,OAAL,EAAc;MACZD,UAAU,GAAGA,UAAU,GAAG,GAA1B;IACD;;IACD,IAAIK,YAAY,GAAGd,UAAU,CAACC,KAAD,EAAQO,MAAR,CAA7B;IACAC,UAAU,GAAGA,UAAU,GAAI,GAAEE,GAAI,IAAGG,YAAa,EAAjD;IACAJ,OAAO,GAAG,KAAV;EACD;;EACDD,UAAU,GAAGA,UAAU,GAAG,GAA1B;EACA,OAAOA,UAAP;AACD;AAED,OAAO,eAAeM,YAAf,CACLC,MADK,EAELC,YAFK,EAGLC,KAHK,EAILX,MAJK,EAKLC,MALK,EAML;EACA,MAAMW,OAAO,GAAI,aAAYD,KAAM,IAAGZ,aAAa,CAACC,MAAD,EAASC,MAAT,CAAiB,GAApE;;EACA,IAAIA,MAAM,KAAK,KAAf,EAAsB;IACpB,OAAOY,eAAe,CAACJ,MAAD,EAASC,YAAT,EAAuBE,OAAvB,CAAtB;EACD,CAFD,MAEO;IACL,MAAM,IAAIE,KAAJ,CAAW,kBAAiBb,MAAO,EAAnC,CAAN;EACD;AACF;;AAED,eAAeY,eAAf,CACEJ,MADF,EAEEC,YAFF,EAGEE,OAHF,EAIE;EACA,MAAMH,MAAM,CAACM,KAAP,CACH;AACL,wBAAwBL,YAAa,SAAQE,OAAQ,oBAF7C,CAAN;AAID;;AAED,OAAO,eAAeI,UAAf,CACLP,MADK,EAELE,KAFK,EAGLX,MAHK,EAILU,YAJK,EAKLO,cALK,EAMLC,YANK,EAOLC,aAPK,EAQLC,WARK,EASLnB,MATK,EAUL;EACA,MAAMW,OAAO,GAAI,YAAWK,cAAe,WAAUxB,UAAU,CAC7D0B,aAD6D,EAE7DlB,MAF6D,CAG7D,SAAQU,KAAM,IAAGZ,aAAa,CAC9BC,MAD8B,EAE9BC,MAF8B,CAG9B,QAAOiB,YAAa,WAAUzB,UAAU,CAAC2B,WAAD,EAAcnB,MAAd,CAAsB,IANhE;;EAOA,IAAIA,MAAM,KAAK,KAAf,EAAsB;IACpB,OAAOoB,aAAa,CAACZ,MAAD,EAASC,YAAT,EAAuBE,OAAvB,CAApB;EACD,CAFD,MAEO;IACL,MAAM,IAAIE,KAAJ,CAAW,kBAAiBb,MAAO,EAAnC,CAAN;EACD;AACF;;AAED,eAAeoB,aAAf,CACEZ,MADF,EAEEC,YAFF,EAGEE,OAHF,EAIE;EACA,MAAMH,MAAM,CAACM,KAAP,CACH;AACL,wBAAwBL,YAAa,SAAQE,OAAQ,oBAF7C,CAAN;AAID"}