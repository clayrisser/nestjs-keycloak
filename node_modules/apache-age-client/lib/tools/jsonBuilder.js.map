{"version":3,"file":"jsonBuilder.js","names":["stringWrap","value","_flavor","flavors","AGE","JSON","stringify","jsonStringify","record","flavor","ageJsonStr","isFirst","key","Object","entries","valueWrapped","createVertex","client","graphPathStr","label","createQ","ageCreateVertex","Error","query","createEdge","edgeStartLabel","edgeEndLabel","startNodeName","endNodeName","AGECreateEdge"],"sources":["../../src/tools/jsonBuilder.ts"],"sourcesContent":["/**\n * File: /src/tools/jsonBuilder.ts\n * Project: apache-age-client\n * File Created: 13-09-2022 05:24:37\n * Author: Apache Software Foundation\n * -----\n * Last Modified: 13-09-2022 07:01:22\n * Modified By: Clay Risser\n * -----\n * Risser Labs LLC (c) Copyright 2022\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Client } from \"pg\";\nimport { AgeRecord, Flavor } from \"../types\";\nimport { flavors } from \"../config\";\n\nexport function stringWrap(value: string, _flavor: Flavor = flavors.AGE) {\n  return JSON.stringify(value);\n}\n\nexport function jsonStringify(record: AgeRecord, flavor = flavors.AGE) {\n  let ageJsonStr = \"{\";\n  let isFirst = true;\n  for (const [key, value] of Object.entries(record)) {\n    if (!isFirst) {\n      ageJsonStr = ageJsonStr + \",\";\n    }\n    let valueWrapped = stringWrap(value, flavor);\n    ageJsonStr = ageJsonStr + `${key}:${valueWrapped}`;\n    isFirst = false;\n  }\n  ageJsonStr = ageJsonStr + \"}\";\n  return ageJsonStr;\n}\n\nexport async function createVertex(\n  client: Client,\n  graphPathStr: string,\n  label: string,\n  record: AgeRecord,\n  flavor: Flavor\n) {\n  const createQ = `CREATE (n:${label} ${jsonStringify(record, flavor)})`;\n  if (flavor === \"AGE\") {\n    return ageCreateVertex(client, graphPathStr, createQ);\n  } else {\n    throw new Error(`Unknown flavor ${flavor}`);\n  }\n}\n\nasync function ageCreateVertex(\n  client: Client,\n  graphPathStr: string,\n  createQ: string\n) {\n  await client.query(\n    `select *\n         from cypher('${graphPathStr}', $$ ${createQ} $$) as (a agtype)`\n  );\n}\n\nexport async function createEdge(\n  client: Client,\n  label: string,\n  record: AgeRecord,\n  graphPathStr: string,\n  edgeStartLabel: string,\n  edgeEndLabel: string,\n  startNodeName: string,\n  endNodeName: string,\n  flavor: Flavor\n) {\n  const createQ = `CREATE (:${edgeStartLabel} {name: ${stringWrap(\n    startNodeName,\n    flavor\n  )}})-[n:${label} ${jsonStringify(\n    record,\n    flavor\n  )}]->(:${edgeEndLabel} {name: ${stringWrap(endNodeName, flavor)}})`;\n  if (flavor === \"AGE\") {\n    return AGECreateEdge(client, graphPathStr, createQ);\n  } else {\n    throw new Error(`Unknown flavor ${flavor}`);\n  }\n}\n\nasync function AGECreateEdge(\n  client: Client,\n  graphPathStr: string,\n  createQ: string\n) {\n  await client.query(\n    `select *\n         from cypher('${graphPathStr}', $$ ${createQ} $$) as (a agtype)`\n  );\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;EAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAMO,SAASA,UAAT,CAAoBC,KAApB,EAAkE;IAAA,IAA/BC,OAA+B,uEAAbC,eAAA,CAAQC,GAAK;;IACvE,OAAOC,IAAI,CAACC,SAAL,CAAeL,KAAf,CAAP;EACD;;EAEM,SAASM,aAAT,CAAuBC,MAAvB,EAAgE;IAAA,IAAtBC,MAAsB,uEAAbN,eAAA,CAAQC,GAAK;IACrE,IAAIM,UAAU,GAAG,GAAjB;IACA,IAAIC,OAAO,GAAG,IAAd;;IACA,KAAK,MAAM,CAACC,GAAD,EAAMX,KAAN,CAAX,IAA2BY,MAAM,CAACC,OAAP,CAAeN,MAAf,CAA3B,EAAmD;MACjD,IAAI,CAACG,OAAL,EAAc;QACZD,UAAU,GAAGA,UAAU,GAAG,GAA1B;MACD;;MACD,IAAIK,YAAY,GAAGf,UAAU,CAACC,KAAD,EAAQQ,MAAR,CAA7B;MACAC,UAAU,GAAGA,UAAU,GAAI,GAAEE,GAAI,IAAGG,YAAa,EAAjD;MACAJ,OAAO,GAAG,KAAV;IACD;;IACDD,UAAU,GAAGA,UAAU,GAAG,GAA1B;IACA,OAAOA,UAAP;EACD;;EAEM,eAAeM,YAAf,CACLC,MADK,EAELC,YAFK,EAGLC,KAHK,EAILX,MAJK,EAKLC,MALK,EAML;IACA,MAAMW,OAAO,GAAI,aAAYD,KAAM,IAAGZ,aAAa,CAACC,MAAD,EAASC,MAAT,CAAiB,GAApE;;IACA,IAAIA,MAAM,KAAK,KAAf,EAAsB;MACpB,OAAOY,eAAe,CAACJ,MAAD,EAASC,YAAT,EAAuBE,OAAvB,CAAtB;IACD,CAFD,MAEO;MACL,MAAM,IAAIE,KAAJ,CAAW,kBAAiBb,MAAO,EAAnC,CAAN;IACD;EACF;;EAED,eAAeY,eAAf,CACEJ,MADF,EAEEC,YAFF,EAGEE,OAHF,EAIE;IACA,MAAMH,MAAM,CAACM,KAAP,CACH;AACL,wBAAwBL,YAAa,SAAQE,OAAQ,oBAF7C,CAAN;EAID;;EAEM,eAAeI,UAAf,CACLP,MADK,EAELE,KAFK,EAGLX,MAHK,EAILU,YAJK,EAKLO,cALK,EAMLC,YANK,EAOLC,aAPK,EAQLC,WARK,EASLnB,MATK,EAUL;IACA,MAAMW,OAAO,GAAI,YAAWK,cAAe,WAAUzB,UAAU,CAC7D2B,aAD6D,EAE7DlB,MAF6D,CAG7D,SAAQU,KAAM,IAAGZ,aAAa,CAC9BC,MAD8B,EAE9BC,MAF8B,CAG9B,QAAOiB,YAAa,WAAU1B,UAAU,CAAC4B,WAAD,EAAcnB,MAAd,CAAsB,IANhE;;IAOA,IAAIA,MAAM,KAAK,KAAf,EAAsB;MACpB,OAAOoB,aAAa,CAACZ,MAAD,EAASC,YAAT,EAAuBE,OAAvB,CAApB;IACD,CAFD,MAEO;MACL,MAAM,IAAIE,KAAJ,CAAW,kBAAiBb,MAAO,EAAnC,CAAN;IACD;EACF;;EAED,eAAeoB,aAAf,CACEZ,MADF,EAEEC,YAFF,EAGEE,OAHF,EAIE;IACA,MAAMH,MAAM,CAACM,KAAP,CACH;AACL,wBAAwBL,YAAa,SAAQE,OAAQ,oBAF7C,CAAN;EAID"}